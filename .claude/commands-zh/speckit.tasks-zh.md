---
description: 根据可用的设计文件为功能生成可操作的、依赖排序的 tasks.md。
---

## 用户输入

```text
$ARGUMENTS
```

在继续之前，你**必须**考虑用户输入（如果非空）。

## 概述

1. **设置**：从仓库根目录运行 `.specify/scripts/powershell/check-prerequisites.ps1 -Json` 并解析 FEATURE_DIR 和 AVAILABLE_DOCS 列表。所有路径必须是绝对路径。

2. **加载设计文档**：从 FEATURE_DIR 读取：
   - **必需**：plan.md（技术栈、库、结构）、spec.md（带有优先级的用户故事）
   - **可选**：data-model.md（实体）、contracts/（API 端点）、research.md（决策）、quickstart.md（测试场景）
   - 注意：并非所有项目都有所有文档。根据可用内容生成任务。

3. **执行任务生成工作流程**（遵循模板结构）：
   - 加载 plan.md 并提取技术栈、库、项目结构
   - **加载 spec.md 并提取带有优先级（P1、P2、P3 等）的用户故事**
   - 如果 data-model.md 存在：提取实体 → 映射到用户故事
   - 如果 contracts/ 存在：每个文件 → 将端点映射到用户故事
   - 如果 research.md 存在：提取决策 → 生成设置任务
   - **按用户故事组织生成任务**：
     - 设置任务（所有故事所需的共享基础设施）
     - **基础任务（必须在任何用户故事开始之前完成的先决条件）**
     - 对于每个用户故事（按优先级顺序 P1、P2、P3...）：
       - 将完成该故事所需的所有任务分组
       - 包括特定于该故事的模型、服务、端点、UI 组件
       - 标记哪些任务是 [P] 可并行化的
       - 如果请求测试：包括特定于该故事的测试
     - 完善/集成任务（跨领域关注点）
   - **测试是可选的**：仅在功能规格中明确请求或用户请求 TDD 方法时才生成测试任务
   - 应用任务规则：
     - 不同文件 = 标记 [P] 为并行
     - 相同文件 = 顺序（无 [P]）
     - 如果请求测试：实施前的测试（TDD 顺序）
   - 顺序编号任务（T001、T002...）
   - 生成显示用户故事完成顺序的依赖图
   - 为每个用户故事创建并行执行示例
   - 验证任务完整性（每个用户故事都有所有需要的任务，可独立测试）

4. **生成 tasks.md**：使用 `.specify/templates/tasks-template.md` 作为结构，填写：
   - 来自 plan.md 的正确功能名称
   - 阶段 1：设置任务（项目初始化）
   - 阶段 2：基础任务（所有用户故事的阻塞先决条件）
   - 阶段 3+：每个用户故事一个阶段（按 spec.md 的优先级顺序）
     - 每个阶段包括：故事目标、独立测试标准、测试（如果请求）、实施任务
     - 清晰的 [故事] 标签（US1、US2、US3...）用于每个任务
     - [P] 标记用于每个故事中的可并行化任务
     - 每个故事阶段后的检查点标记
   - 最终阶段：完善和跨领域关注点
   - 执行顺序中的编号任务（T001、T002...）
   - 每个任务的清晰文件路径
   - 显示故事完成顺序的依赖部分
   - 每个故事的并行执行示例
   - 实施策略部分（MVP 优先，增量交付）

5. **报告**：输出生成的 tasks.md 的路径和摘要：
   - 总任务计数
   - 每个用户故事的任务计数
   - 识别的并行机会
   - 每个故事的独立测试标准
   - 建议的 MVP 范围（通常只是用户故事 1）

任务生成的上下文：$ARGUMENTS

tasks.md 应该是立即可执行的 - 每个任务必须足够具体，以便 LLM 可以在没有额外上下文的情况下完成它。

## 任务生成规则

**重要**：测试是可选的。仅在用户在功能规格中明确请求测试或 TDD 方法时才生成测试任务。

**关键**：任务必须按用户故事组织，以实现独立的实施和测试。

1. **从用户故事（spec.md）** - 主要组织：
   - 每个用户故事（P1、P2、P3...）获得自己的阶段
   - 将所有相关组件映射到它们的故事：
     - 该故事所需的模型
     - 该故事所需的服务
     - 该故事所需的端点/UI
     - 如果请求测试：特定于该故事的测试
   - 标记故事依赖（大多数故事应该是独立的）
   
2. **从合约**：
   - 将每个合约/端点 → 映射到它服务的用户故事
   - 如果请求测试：每个合约 → 合约测试任务 [P] 在该故事阶段的实施之前
   
3. **从数据模型**：
   - 将每个实体 → 映射到需要它的用户故事
   - 如果实体服务多个故事：放入最早的故事或设置阶段
   - 关系 → 适当故事阶段中的服务层任务
   
4. **从设置/基础设施**：
   - 共享基础设施 → 设置阶段（阶段 1）
   - 基础/阻塞任务 → 基础阶段（阶段 2）
     - 示例：数据库架构设置、身份验证框架、核心库、基本配置
     - 这些必须在任何用户故事可以实施之前完成
   - 特定于故事的设置 → 在该故事的阶段内

5. **排序**：
   - 阶段 1：设置（项目初始化）
   - 阶段 2：基础（阻塞先决条件 - 必须在用户故事之前完成）
   - 阶段 3+：按优先级顺序的用户故事（P1、P2、P3...）
     - 在每个故事中：测试（如果请求）→ 模型 → 服务 → 端点 → 集成
   - 最终阶段：完善和跨领域关注点
   - 每个用户故事阶段应该是一个完整的、可独立测试的增量

